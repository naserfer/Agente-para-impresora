# ğŸ¨ Diagrama Visual - CÃ³mo Funciona Todo

## ğŸ“Š Vista General del Sistema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TU APLICACIÃ“N WEB                            â”‚
â”‚                  (Next.js + Supabase)                           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚   Usuario    â”‚         â”‚   Base de    â”‚                     â”‚
â”‚  â”‚   (Lomitero) â”‚         â”‚   Datos      â”‚                     â”‚
â”‚  â”‚              â”‚         â”‚  (Supabase)  â”‚                     â”‚
â”‚  â”‚  Juan PÃ©rez  â”‚         â”‚              â”‚                     â”‚
â”‚  â”‚              â”‚         â”‚  - Usuarios   â”‚                     â”‚
â”‚  â”‚  LomiterÃ­a:  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  - LomiterÃ­asâ”‚                     â”‚
â”‚  â”‚  El Buen     â”‚         â”‚  - Impresorasâ”‚                     â”‚
â”‚  â”‚  Sabor       â”‚         â”‚  - Ã“rdenes    â”‚                     â”‚
â”‚  â”‚  (ID: 001)   â”‚         â”‚              â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚         â”‚                       â”‚                             â”‚
â”‚         â”‚ 1. Crea orden        â”‚ 2. Busca config             â”‚
â”‚         â”‚    de pedido          â”‚    de impresora              â”‚
â”‚         â”‚                       â”‚                             â”‚
â”‚         â–¼                       â–¼                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  BotÃ³n "Imprimir Ticket de Cocina"      â”‚                 â”‚
â”‚  â”‚                                          â”‚                 â”‚
â”‚  â”‚  Tu app busca en Supabase:              â”‚                 â”‚
â”‚  â”‚  - Â¿QuÃ© printerId tiene lomiteria-001? â”‚                 â”‚
â”‚  â”‚  - Respuesta: "lomiteria-001"           â”‚                 â”‚
â”‚  â”‚  - Â¿DÃ³nde estÃ¡ el agente?               â”‚                 â”‚
â”‚  â”‚  - Respuesta: "192.168.1.50:8080"       â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                 â”‚                                            â”‚
â”‚                 â”‚ 3. EnvÃ­a peticiÃ³n HTTP                    â”‚
â”‚                 â”‚    POST http://192.168.1.50:8080/...      â”‚
â”‚                 â”‚    {                                       â”‚
â”‚                 â”‚      printerId: "lomiteria-001",          â”‚
â”‚                 â”‚      orderData: {...}                     â”‚
â”‚                 â”‚    }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ ğŸŒ Internet o Red Local
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AGENTE DE IMPRESIÃ“N                                 â”‚
â”‚         (Corre en la PC del local)                             â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SERVIDOR (server.js)                                     â”‚ â”‚
â”‚  â”‚  - Escucha en puerto 8080                                â”‚ â”‚
â”‚  â”‚  - Recibe peticiones de tu app web                       â”‚ â”‚
â”‚  â”‚  - Procesa las Ã³rdenes de impresiÃ³n                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                 â”‚                                              â”‚
â”‚                 â”‚ 4. Recibe la peticiÃ³n                       â”‚
â”‚                 â”‚    printerId: "lomiteria-001"                â”‚
â”‚                 â”‚    orderData: {...}                           â”‚
â”‚                 â”‚                                              â”‚
â”‚                 â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  PRINTER MANAGER (PrinterManager.js)                       â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Busca en su lista:                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚ â”‚
â”‚  â”‚  â”‚ Impresoras Configuradas:              â”‚                â”‚ â”‚
â”‚  â”‚  â”‚                                        â”‚                â”‚ â”‚
â”‚  â”‚  â”‚ "lomiteria-001" â†’ Impresora USB 1     â”‚                â”‚ â”‚
â”‚  â”‚  â”‚ "lomiteria-002" â†’ Impresora USB 2     â”‚                â”‚ â”‚
â”‚  â”‚  â”‚ "lomiteria-003" â†’ Impresora Red       â”‚                â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Â¿Encuentra "lomiteria-001"?                              â”‚ â”‚
â”‚  â”‚  âœ… SÃ­ â†’ Usa esa impresora                                â”‚ â”‚
â”‚  â”‚  âŒ No â†’ Error                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                 â”‚                                              â”‚
â”‚                 â”‚ 5. Pasa los datos al generador              â”‚
â”‚                 â”‚                                              â”‚
â”‚                 â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  TICKET GENERATOR (TicketGenerator.js)                   â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Toma los datos:                                          â”‚ â”‚
â”‚  â”‚  - orderId: "ORD-12345"                                   â”‚ â”‚
â”‚  â”‚  - items: [...]                                           â”‚ â”‚
â”‚  â”‚  - lomiteriaName: "El Buen Sabor"                         â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Crea el diseÃ±o del ticket:                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚ â”‚
â”‚  â”‚  â”‚  EL BUEN SABOR      â”‚                                 â”‚ â”‚
â”‚  â”‚  â”‚  TICKET DE COCINA    â”‚                                 â”‚ â”‚
â”‚  â”‚  â”‚  Orden: #ORD-12345   â”‚                                 â”‚ â”‚
â”‚  â”‚  â”‚  Items: ...          â”‚                                 â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Convierte a comandos ESC/POS                             â”‚ â”‚
â”‚  â”‚  (formato que la impresora entiende)                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                 â”‚                                              â”‚
â”‚                 â”‚ 6. Devuelve el buffer de comandos          â”‚
â”‚                 â”‚                                              â”‚
â”‚                 â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  PRINTER MANAGER (de nuevo)                               â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Abre conexiÃ³n con la impresora fÃ­sica                    â”‚ â”‚
â”‚  â”‚  EnvÃ­a los comandos ESC/POS                               â”‚ â”‚
â”‚  â”‚  Cierra la conexiÃ³n                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                 â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ ğŸ”Œ USB o ğŸŒ Red
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    IMPRESORA TÃ‰RMICA                             â”‚
â”‚                  (Hardware fÃ­sico)                               â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Recibe comandos ESC/POS                                 â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Imprime:                                                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚ â”‚
â”‚  â”‚  â”‚  EL BUEN SABOR      â”‚  â† En papel tÃ©rmico            â”‚ â”‚
â”‚  â”‚  â”‚  TICKET DE COCINA    â”‚                                 â”‚ â”‚
â”‚  â”‚  â”‚  Orden: #ORD-12345   â”‚                                 â”‚ â”‚
â”‚  â”‚  â”‚  2x Lomo Completo    â”‚                                 â”‚ â”‚
â”‚  â”‚  â”‚  1x Papas Fritas     â”‚                                 â”‚ â”‚
â”‚  â”‚  â”‚  ...                 â”‚                                 â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Corta el papel automÃ¡ticamente                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ Puntos Clave del Diagrama

### 1. **IdentificaciÃ³n de la LomiterÃ­a**

```
Usuario â†’ LomiterÃ­a ID â†’ Printer ID
```

**Ejemplo:**
- Usuario: Juan PÃ©rez
- LomiterÃ­a ID: `lomiteria-001`
- Printer ID: `lomiteria-001` (generalmente el mismo)

### 2. **Flujo de Datos**

```
App Web â†’ Base de Datos â†’ Busca Config â†’ Agente â†’ Impresora
```

**Paso a paso:**
1. Usuario hace clic en "Imprimir"
2. App busca en Supabase: Â¿QuÃ© `printerId` tiene esta lomiterÃ­a?
3. App envÃ­a orden al agente con ese `printerId`
4. Agente busca la impresora con ese ID
5. Agente genera el ticket
6. Agente envÃ­a a la impresora fÃ­sica

### 3. **Multi-Tenant (MÃºltiples LomiterÃ­as)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Agente puede tener mÃºltiples           â”‚
â”‚  impresoras configuradas:               â”‚
â”‚                                         â”‚
â”‚  printerId: "lomiteria-001"            â”‚
â”‚  printerId: "lomiteria-002"             â”‚
â”‚  printerId: "lomiteria-003"            â”‚
â”‚                                         â”‚
â”‚  Cuando llega una orden, busca          â”‚
â”‚  la impresora correcta por su ID        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ Tabla de Relaciones

| Usuario | LomiterÃ­a ID | Printer ID | IP del Agente | Impresora FÃ­sica |
|---------|--------------|------------|---------------|------------------|
| Juan    | lomiteria-001| lomiteria-001 | 192.168.1.50 | USB 1 |
| MarÃ­a   | lomiteria-002| lomiteria-002 | 192.168.1.51 | USB 2 |
| Pedro   | lomiteria-003| lomiteria-003 | 192.168.1.52 | Red |

**Â¿CÃ³mo se relacionan?**
1. Usuario inicia sesiÃ³n â†’ App sabe su `lomiteriaId`
2. Usuario imprime â†’ App busca `printerId` usando el `lomiteriaId`
3. App envÃ­a orden al agente con el `printerId`
4. Agente busca la impresora fÃ­sica usando el `printerId`

---

## ğŸ¯ Ejemplo Visual Completo

### Escenario: Juan imprime un ticket

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 1: Juan inicia sesiÃ³n                                  â”‚
â”‚                                                             â”‚
â”‚  App busca en Supabase:                                    â”‚
â”‚  Â¿QuiÃ©n es juan@elbuensabor.com?                           â”‚
â”‚                                                             â”‚
â”‚  Respuesta:                                                 â”‚
â”‚  {                                                          â”‚
â”‚    id: "user-123",                                          â”‚
â”‚    nombre: "Juan PÃ©rez",                                    â”‚
â”‚    lomiteriaId: "lomiteria-001"  â† Identifica la lomiterÃ­aâ”‚
â”‚  }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 2: Juan crea una orden                                â”‚
â”‚                                                             â”‚
â”‚  App guarda en Supabase:                                   â”‚
â”‚  {                                                          â”‚
â”‚    orderId: "ORD-12345",                                    â”‚
â”‚    lomiteriaId: "lomiteria-001",  â† De quÃ© lomiterÃ­a es   â”‚
â”‚    items: [...]                                             â”‚
â”‚  }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 3: Juan hace clic en "Imprimir"                        â”‚
â”‚                                                             â”‚
â”‚  App busca en Supabase:                                     â”‚
â”‚  Â¿QuÃ© printerId tiene lomiteria-001?                       â”‚
â”‚                                                             â”‚
â”‚  Respuesta:                                                 â”‚
â”‚  {                                                          â”‚
â”‚    printer_id: "lomiteria-001",  â† QuÃ© impresora usar     â”‚
â”‚    agent_ip: "192.168.1.50",      â† DÃ³nde estÃ¡ el agente   â”‚
â”‚    agent_port: 8080                                         â”‚
â”‚  }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 4: App envÃ­a orden al agente                          â”‚
â”‚                                                             â”‚
â”‚  POST http://192.168.1.50:8080/api/print/kitchen-ticket     â”‚
â”‚  {                                                          â”‚
â”‚    printerId: "lomiteria-001",  â† Le dice al agente        â”‚
â”‚    orderData: {...}           â† Los datos del ticket       â”‚
â”‚  }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 5: Agente busca la impresora                          â”‚
â”‚                                                             â”‚
â”‚  printerManager.printers.get("lomiteria-001")              â”‚
â”‚                                                             â”‚
â”‚  Â¿Existe? â†’ âœ… SÃ­                                           â”‚
â”‚  Impresora encontrada: Impresora USB 1                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 6: Agente genera el ticket                            â”‚
â”‚                                                             â”‚
â”‚  TicketGenerator.generateKitchenTicket(orderData)         â”‚
â”‚                                                             â”‚
â”‚  Crea el diseÃ±o y lo convierte a comandos ESC/POS         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 7: Agente envÃ­a a la impresora                        â”‚
â”‚                                                             â”‚
â”‚  printerManager.print("lomiteria-001", ticketBuffer)       â”‚
â”‚                                                             â”‚
â”‚  Abre conexiÃ³n â†’ EnvÃ­a comandos â†’ Cierra conexiÃ³n          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 8: Impresora imprime                                  â”‚
â”‚                                                             â”‚
â”‚  Recibe comandos ESC/POS                                   â”‚
â”‚  Imprime el ticket en papel tÃ©rmico                        â”‚
â”‚  Corta el papel                                            â”‚
â”‚                                                             â”‚
â”‚  âœ… Ticket impreso exitosamente                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ Conceptos Visuales

### Â¿QuÃ© es el `printerId`?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Es como el "nombre" de cada        â”‚
â”‚  impresora en el agente             â”‚
â”‚                                     â”‚
â”‚  lomiteria-001  â†’  Impresora 1     â”‚
â”‚  lomiteria-002  â†’  Impresora 2     â”‚
â”‚  lomiteria-003  â†’  Impresora 3     â”‚
â”‚                                     â”‚
â”‚  Cuando llega una orden con         â”‚
â”‚  printerId: "lomiteria-001",        â”‚
â”‚  el agente sabe: "Usar Impresora 1" â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Â¿CÃ³mo se identifica la lomiterÃ­a?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Usuario â†’ LomiterÃ­a ID              â”‚
â”‚                                     â”‚
â”‚  Juan PÃ©rez  â†’  lomiteria-001      â”‚
â”‚  MarÃ­a LÃ³pez  â†’  lomiteria-002      â”‚
â”‚  Pedro GarcÃ­a â†’  lomiteria-003     â”‚
â”‚                                     â”‚
â”‚  Cada usuario pertenece a una       â”‚
â”‚  lomiterÃ­a especÃ­fica                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Â¿DÃ³nde se guarda todo?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BASE DE DATOS (Supabase)           â”‚
â”‚                                     â”‚
â”‚  Tabla: users                       â”‚
â”‚  - Usuario â†’ lomiteriaId           â”‚
â”‚                                     â”‚
â”‚  Tabla: printer_config              â”‚
â”‚  - lomiteriaId â†’ printerId         â”‚
â”‚  - lomiteriaId â†’ agent_ip          â”‚
â”‚                                     â”‚
â”‚  Tu app busca aquÃ­ cuando          â”‚
â”‚  alguien quiere imprimir            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

Â¿Ahora tiene mÃ¡s sentido? Si hay algo que no entiendes, dime y lo explico de otra manera.




